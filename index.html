<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶™‡ßç‡¶∞‡¶´‡ßá‡¶∂‡¶®‡¶æ‡¶≤ ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ï‡ßç‡¶∞‡¶ø‡¶ï‡ßá‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞</title>
    <!-- PeerJS for Realtime Data -->
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        :root { --primary: #e63946; --dark: #1d3557; --light: #f1faee; --accent: #457b9d; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; margin: 0; padding: 0; background: #0f172a; color: white; text-align: center; }
        
        /* Header */
        header { background: var(--primary); padding: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }

        /* Container */
        .container { max-width: 800px; margin: 0 auto; padding: 10px; }

        /* Video Section */
        .video-wrapper { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 10px; border: 2px solid #333; background: black; margin-bottom: 15px; }
        .video-wrapper iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
        .placeholder-video { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #aaa; }

        /* Scoreboard Section */
        .scoreboard { background: linear-gradient(145deg, #1e293b, #0f172a); padding: 20px; border-radius: 15px; border-top: 4px solid var(--accent); box-shadow: 0 4px 15px rgba(0,0,0,0.5); margin-bottom: 20px; }
        .team-names { font-size: 1.1rem; color: #94a3b8; margin-bottom: 5px; }
        .main-score { font-size: 3.5rem; font-weight: 800; color: #fff; line-height: 1; text-shadow: 0 0 10px rgba(69, 123, 157, 0.5); }
        .wickets { font-size: 1.5rem; color: #e63946; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 8px; }
        .stat-item span { display: block; font-size: 0.9rem; color: #94a3b8; }
        .stat-item strong { font-size: 1.2rem; color: #a8dadc; }
        
        /* Commentary / Status */
        .status-bar { background: #334155; padding: 8px; border-radius: 5px; font-size: 0.9rem; color: #fbbf24; margin-top: 10px; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.8; } 100% { opacity: 1; } }

        /* Connection UI */
        .connect-box { background: #1e293b; padding: 20px; border-radius: 10px; margin-top: 20px; }
        input { padding: 12px; border-radius: 6px; border: 1px solid #475569; background: #0f172a; color: white; width: 70%; font-size: 1rem; }
        button { padding: 12px 20px; border-radius: 6px; border: none; font-size: 1rem; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-join { background: var(--accent); color: white; }
        .btn-admin { background: #333; color: #aaa; margin-top: 50px; font-size: 0.8rem; padding: 5px 10px; }

        /* Admin Panel */
        .admin-panel { display: none; text-align: left; background: #0f172a; padding: 15px; border-radius: 10px; border: 1px solid #333; }
        .control-group { margin-bottom: 20px; padding: 10px; background: #1e293b; border-radius: 8px; }
        .control-label { display: block; margin-bottom: 5px; color: #a8dadc; }
        .score-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .btn-score { background: #334155; color: white; padding: 15px; font-size: 1.2rem; }
        .btn-out { background: #e63946; }
        .btn-update { background: #10b981; width: 100%; margin-top: 10px; }
        
        .hidden { display: none !important; }
    </style>
</head>
<body>

<header>
    <h1>üèè ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ï‡ßç‡¶∞‡¶ø‡¶ï‡ßá‡¶ü ‡¶∏‡ßç‡¶ï‡ßã‡¶∞</h1>
</header>

<div class="container">

    <!-- VIDEO SECTION -->
    <div class="video-wrapper">
        <div id="video-placeholder" class="placeholder-video">
            <i class="fas fa-tv fa-3x"></i><br><br>
            ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá...
        </div>
        <div id="youtube-frame-container"></div>
    </div>

    <!-- SCOREBOARD -->
    <div class="scoreboard">
        <div class="team-names">‡¶≤‡¶æ‡¶á‡¶≠ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö</div>
        <div class="main-score">
            <span id="display-runs">0</span>/<span id="display-wickets">0</span>
        </div>
        <div class="stats-grid">
            <div class="stat-item"><span>‡¶ì‡¶≠‡¶æ‡¶∞</span> <strong id="display-overs">0.0</strong></div>
            <div class="stat-item"><span>‡¶ü‡¶æ‡¶∞‡ßç‡¶ó‡ßá‡¶ü</span> <strong id="display-target">-</strong></div>
        </div>
        <div class="status-bar" id="match-status">‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ‡ßü...</div>
    </div>

    <!-- VIEWER CONNECTION -->
    <div id="viewer-controls" class="connect-box">
        <h3>‡¶¶‡¶∞‡ßç‡¶∂‡¶ï ‡¶ú‡ßã‡¶®</h3>
        <p style="color:#aaa; font-size:0.9rem;">‡¶è‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶ï‡ßã‡¶°‡¶ü‡¶ø ‡¶®‡¶ø‡¶ö‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:</p>
        <input type="text" id="join-code" placeholder="‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶ï‡ßã‡¶° (‡¶Ø‡ßá‡¶Æ‡¶®: 1234)">
        <button class="btn-join" onclick="joinMatch()">‡¶≤‡¶æ‡¶á‡¶≠ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
        <p id="connection-status" style="margin-top:10px; color:#10b981;"></p>
    </div>

    <!-- ADMIN LOGIN BUTTON -->
    <button class="btn-admin" onclick="openAdminPanel()">Admin Access</button>

    <!-- ADMIN PANEL (Hidden by default) -->
    <div id="admin-panel" class="admin-panel">
        <h2 style="color:var(--accent); text-align:center;">‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶ï‡¶®‡ßç‡¶ü‡ßç‡¶∞‡ßã‡¶≤ ‡¶∞‡ßÅ‡¶Æ</h2>
        
        <!-- Step 1: Host ID -->
        <div class="control-group">
            <span class="control-label">‡ßß. ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶ï‡ßã‡¶° (‡¶è‡¶ü‡¶ø ‡¶¶‡¶∞‡ßç‡¶∂‡¶ï‡¶¶‡ßá‡¶∞ ‡¶¶‡¶ø‡¶®):</span>
            <div style="font-size:1.5rem; font-weight:bold; color:#10b981; text-align:center; letter-spacing:3px;" id="my-admin-id">...</div>
        </div>

        <!-- Step 2: Video Setup -->
        <div class="control-group">
            <span class="control-label">‡ß®. ‡¶á‡¶â‡¶ü‡¶ø‡¶â‡¶¨/‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶≤‡¶ø‡¶Ç‡¶ï (Embed):</span>
            <input type="text" id="video-id-input" placeholder="YouTube Video ID (e.g. jX3h5...)">
            <button class="btn-join" style="width:100%; margin-top:5px;" onclick="updateVideo()">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            <small style="color:#aaa; display:block; margin-top:5px;">YouTube ‡¶è ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ Video ID ‡¶ü‡¶ø ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶®‡•§</small>
        </div>

        <!-- Step 3: Scoring -->
        <div class="control-group">
            <span class="control-label">‡ß©. ‡¶∏‡ßç‡¶ï‡ßã‡¶∞ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü:</span>
            <div class="score-buttons">
                <button class="btn-score" onclick="addRuns(0)">0</button>
                <button class="btn-score" onclick="addRuns(1)">1</button>
                <button class="btn-score" onclick="addRuns(2)">2</button>
                <button class="btn-score" onclick="addRuns(3)">3</button>
                <button class="btn-score" onclick="addRuns(4)">4</button>
                <button class="btn-score" onclick="addRuns(6)">6</button>
                <button class="btn-score" onclick="addRuns('WD')">WD</button>
                <button class="btn-score btn-out" onclick="addRuns('W')">OUT</button>
            </div>
            <div style="display:flex; gap:5px; margin-top:10px;">
                <input type="text" id="status-input" placeholder="‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ (‡¶Ø‡ßá‡¶Æ‡¶®: ‡¶¨‡¶ø‡¶∞‡¶§‡¶ø)">
                <button onclick="updateStatus()" style="width:30%;">‡¶Ü‡¶™‡¶°‡ßá‡¶ü</button>
            </div>
            <button class="btn-score" style="width:100%; margin-top:10px; background:#475569;" onclick="undoLast()">‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá? (Undo)</button>
        </div>
    </div>

</div>

<script>
    // Global Variables
    let peer;
    let connections = []; // Stores all viewer connections
    let matchData = {
        runs: 0,
        wickets: 0,
        balls: 0,
        overs: "0.0",
        target: "-",
        status: "‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ö‡¶≤‡¶õ‡ßá",
        videoId: ""
    };
    let historyStack = []; // For Undo functionality

    // --- ADMIN FUNCTIONS ---
    
    function openAdminPanel() {
        const pin = prompt("‡¶è‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶ø‡¶® ‡¶∏‡ßá‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶® (‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ):");
        if(pin) {
            document.getElementById('viewer-controls').classList.add('hidden');
            document.getElementById('admin-panel').style.display = 'block';
            initAdmin();
        }
    }

    function initAdmin() {
        // Generate random 4-digit code
        const adminId = Math.floor(1000 + Math.random() * 9000).toString();
        document.getElementById('my-admin-id').innerText = adminId;

        peer = new Peer(adminId);
        
        peer.on('open', (id) => {
            console.log("Admin ID: " + id);
        });

        peer.on('connection', (conn) => {
            connections.push(conn);
            // Send current data immediately to new viewer
            conn.on('open', () => {
                conn.send(matchData);
            });
        });
    }

    function broadcastData() {
        // Send data to all 100+ viewers
        connections.forEach((conn) => {
            if(conn.open) {
                conn.send(matchData);
            }
        });
        // Update Admin UI as well
        updateUI(matchData);
    }

    function addRuns(val) {
        // Save history for undo
        historyStack.push(JSON.parse(JSON.stringify(matchData)));

        if(val === 'W') {
            matchData.wickets++;
            matchData.balls++;
        } else if (val === 'WD') {
            matchData.runs++;
            // Ball not counted
        } else {
            matchData.runs += val;
            matchData.balls++;
        }
        
        updateOvers();
        broadcastData();
    }

    function updateOvers() {
        const overs = Math.floor(matchData.balls / 6);
        const balls = matchData.balls % 6;
        matchData.overs = overs + "." + balls;
    }

    function updateStatus() {
        matchData.status = document.getElementById('status-input').value;
        broadcastData();
    }

    function updateVideo() {
        const rawId = document.getElementById('video-id-input').value;
        // Simple extraction logic if full URL is pasted
        let vId = rawId;
        if(rawId.includes('v=')) vId = rawId.split('v=')[1].split('&')[0];
        if(rawId.includes('youtu.be/')) vId = rawId.split('youtu.be/')[1].split('?')[0];
        
        matchData.videoId = vId;
        broadcastData();
        alert("‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    }

    function undoLast() {
        if(historyStack.length > 0) {
            matchData = historyStack.pop();
            broadcastData();
        }
    }

    // --- VIEWER FUNCTIONS ---

    function joinMatch() {
        const code = document.getElementById('join-code').value;
        if(!code) return alert("‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶®!");

        document.getElementById('connection-status').innerText = "‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
        
        peer = new Peer(); // Random viewer ID
        
        peer.on('open', () => {
            const conn = peer.connect(code);
            
            conn.on('open', () => {
                document.getElementById('connection-status').innerText = "‚úÖ ‡¶ï‡¶æ‡¶®‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶°!";
                document.getElementById('viewer-controls').classList.add('hidden');
            });

            conn.on('data', (data) => {
                updateUI(data);
            });
            
            conn.on('close', () => {
                alert("‡¶≤‡¶æ‡¶á‡¶≠ ‡¶∂‡ßá‡¶∑ ‡¶π‡ßü‡ßá‡¶õ‡ßá ‡¶¨‡¶æ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
            });
        });
    }

    // --- UI UPDATER (Common for both) ---
    function updateUI(data) {
        document.getElementById('display-runs').innerText = data.runs;
        document.getElementById('display-wickets').innerText = data.wickets;
        document.getElementById('display-overs').innerText = data.overs;
        document.getElementById('match-status').innerText = data.status;
        document.getElementById('display-target').innerText = data.target;

        // Video Handling
        const videoContainer = document.getElementById('youtube-frame-container');
        const placeholder = document.getElementById('video-placeholder');
        
        if(data.videoId && videoContainer.innerHTML.indexOf(data.videoId) === -1) {
            placeholder.style.display = 'none';
            videoContainer.innerHTML = `<iframe src="https://www.youtube.com/embed/${data.videoId}?autoplay=1&playsinline=1" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
        }
    }

</script>
</body>
</html>